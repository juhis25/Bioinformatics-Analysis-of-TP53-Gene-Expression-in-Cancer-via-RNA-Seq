
### TP53 Gene Expression Analysis Project

## Overview

This project aims to analyze the expression levels of the TP53 gene in cancerous and normal tissues using RNA-Seq data. The analysis involves merging multiple TSV files, performing statistical analysis, visualizing the results, and using machine learning to identify potential biomarkers.

## Project Structure

- `merge_tsv_files.py`: Script to merge multiple TSV files into a single dataset.
- `analyze_tp53.py`: Script to pre-process the merged data, perform statistical analysis, visualize the results, and train a machine learning model.
- `clinical.tsv`, `exposure.tsv`, `family_history.tsv`, `follow_up.tsv`, `pathology_detail.tsv`: Input TSV files containing relevant data.
- `merged_data.csv`: Merged dataset generated by `merge_tsv_files.py`.
- `tp53_analysis_report.txt`: Report generated by `analyze_tp53.py`.

## Scripts Explanation

### `merge_tsv_files.py`

This script merges multiple TSV files into a single dataset based on a common key (`patient_id`).

```python
import pandas as pd

# Load the TSV files
clinical_df = pd.read_csv('clinical.tsv', sep='\t')
exposure_df = pd.read_csv('exposure.tsv', sep='\t')
family_history_df = pd.read_csv('family_history.tsv', sep='\t')
follow_up_df = pd.read_csv('follow_up.tsv', sep='\t')
pathology_detail_df = pd.read_csv('pathology_detail.tsv', sep='\t')

# Merge the DataFrames on 'patient_id'
merged_df = clinical_df.merge(exposure_df, on='patient_id', how='left') \
                       .merge(family_history_df, on='patient_id', how='left') \
                       .merge(follow_up_df, on='patient_id', how='left') \
                       .merge(pathology_detail_df, on='patient_id', how='left')

# Save the merged DataFrame to a CSV file
merged_df.to_csv('merged_data.csv', index=False)

print("Merged data has been saved to merged_data.csv")
```

#### Explanation:

1. **Loading TSV Files**: The script reads multiple TSV files into Pandas DataFrames.
2. **Merging DataFrames**: The DataFrames are merged on the `patient_id` column using left joins to ensure all patient data is included.
3. **Saving Merged Data**: The merged DataFrame is saved as `merged_data.csv`.

### `analyze_tp53.py`

This script pre-processes the merged data, performs statistical analysis, visualizes the results, and trains a machine learning model to identify potential biomarkers.

```python
import pandas as pd
import numpy as np
import statsmodels.api as sm
from statsmodels.formula.api import ols
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, classification_report

# Load the merged dataset
df = pd.read_csv('merged_data.csv')

# Display basic information
print(df.head())
print(df.info())

# Check for missing values
print(df.isnull().sum())

# Handle missing values if any
df.dropna(inplace=True)

# Perform an ANOVA test to compare expression levels between cancerous and normal tissues
model = ols('expression_level ~ tissue_type', data=df).fit()
anova_table = sm.stats.anova_lm(model, typ=2)

print(anova_table)

# Visualize the expression levels using boxplots
plt.figure(figsize=(10, 6))
sns.boxplot(x='tissue_type', y='expression_level', data=df)
plt.title('TP53 Expression Levels in Cancerous vs. Normal Tissues')
plt.xlabel('Tissue Type')
plt.ylabel('Expression Level')
plt.show()

# Encode categorical variable
df['tissue_type'] = df['tissue_type'].map({'normal': 0, 'cancerous': 1})

# Split the data
X = df[['expression_level']]
y = df['tissue_type']
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)

# Train a Random Forest Classifier
clf = RandomForestClassifier(n_estimators=100, random_state=42)
clf.fit(X_train, y_train)

# Predict and evaluate
y_pred = clf.predict(X_test)
print('Accuracy:', accuracy_score(y_test, y_pred))
print(classification_report(y_test, y_pred))

# Feature importance
importances = clf.feature_importances_
print('Feature Importances:', importances)

# Generate a summary report
report = f"""
Statistical Analysis (ANOVA):
{anova_table}

Random Forest Classifier:
Accuracy: {accuracy_score(y_test, y_pred)}
Classification Report:
{classification_report(y_test, y_pred)}

Feature Importances: {importances}
"""

print(report)

# Save the report to a file
with open('tp53_analysis_report.txt', 'w') as f:
    f.write(report)
```

#### Explanation:

1. **Loading Merged Data**: The script reads the merged dataset from `merged_data.csv`.
2. **Data Pre-processing**: It checks for and handles missing values.
3. **Statistical Analysis**: An ANOVA test compares TP53 expression levels between cancerous and normal tissues.
4. **Data Visualization**: Boxplots visualize the differences in expression levels.
5. **Machine Learning**: A Random Forest Classifier is trained to predict tissue type based on expression levels.
6. **Evaluation**: The model's performance is evaluated and reported.
7. **Report Generation**: A summary report of the analysis and model evaluation is generated and saved as `tp53_analysis_report.txt`.

## Results and Outcomes

- **ANOVA Test Results**: The ANOVA test provides statistical evidence of significant differences in TP53 expression levels between cancerous and normal tissues.
- **Visualization**: Boxplots show the distribution of expression levels, highlighting the differences between tissue types.
- **Random Forest Classifier**: The classifier achieves a certain accuracy, providing a classification report and feature importances.
- **Summary Report**: A detailed report (`tp53_analysis_report.txt`) includes statistical analysis results, model evaluation metrics, and feature importance values.

## How to Run the Scripts

1. **Ensure all input TSV files** are in the same directory as the scripts.
2. **Run the merge script**:

   ```bash
   python merge_tsv_files.py
   ```

3. **Run the analysis script**:

   ```bash
   python analyze_tp53.py
   ```


